{"name":"Service Workers","tagline":"","body":"##What is a Service Worker?\r\nA service worker is a script that is run by your browser in the background, separate from a web page, opening the door to features which don't need a web page or user interaction. Today, they already include features like push notifications and in the future it will include other things like, background sync, or geofencing. The core feature discussed in this tutorial is the ability to intercept and handle network requests, including programmatically managing a cache of responses.\r\n\r\nThe reason this is such an exciting API is that it allows you to support offline experiences, giving developers complete control over what exactly that experience is.\r\n\r\nBefore service worker there was one other API that would give users an offline experience on the web called App Cache. The major issue with App Cache is the number of gotcha's that exist as well as the design working particularly well for single page web apps, but not for multi-page sites. Service workers have been designed to avoid these common pain points.\r\n\r\nThings to note about a service worker:\r\n\r\n- It's a JavaScript Worker, so it can't access the DOM directly. Instead, a service worker can communicate with the pages it controls by responding to messages sent via the postMessage interface, and those pages can manipulate the DOM if needed.\r\n- Service worker is a programmable network proxy, allowing you to control how network requests from your page are handled.\r\n- It will be terminated when not in use, and restarted when it's next needed, so you cannot rely on global state within a service worker's onfetch and onmessage handlers. If there is information that you need to persist and reuse across restarts, service workers do have access to the IndexedDB API.\r\n- Service workers make extensive use of promises, so if you're new to promises, then you should stop reading this and check out Jake Archibald's article.\r\n##Setting up to play with Service Workers\r\nMany service workers features are now enabled by default in newer versions of supporting browsers. If however you find that demo code is not working in your installed versions, you might need to enable a pref:\r\n\r\n- Firefox Nightly: Go to about:config and set dom.serviceWorkers.enabled to true; restart browser.\r\n- Chrome Canary: Go to chrome://flags and turn on experimental-web-platform-features; restart browser (note that some features are now enabled by default in Chrome.)\r\n- Opera: Go to opera://flags and enable Support for ServiceWorker; restart browser.\r\nYou’ll also need to serve your code via HTTPS — Service Workers are restricted to running across HTTPS for security reasons. GitHub is therefore a good place to host experiments, as it supports HTTPS.\r\n\r\n##Basic architecture\r\nWith service workers, the following steps are generally observed for basic set up:\r\n\r\nThe service worker URL is fetched and registered via serviceWorkerContainer.register().\r\nIf successful, the service worker is executed in a ServiceWorkerGlobalScope; this is basically a special kind of worker context, running off the main script execution thread, with no DOM access.\r\nThe service worker is now ready to process events.\r\nInstallation of the worker is attempted when service worker-controlled pages are accessed subsequently. An Install event is always the first one sent to a service worker (this can be used to start the process of populating an IndexedDB, and caching site assets). This is really the same kind of procedure as installing a native or Firefox OS app — making everything available for use offline.\r\nWhen the oninstall handler completes, the service worker is considered installed.\r\nNext is activation. When the service worker is installed, it then receives an activate event. The primary use of onactivate is for cleanup of resources used in previous versions of a Service Worker script.\r\nThe Service Worker will now control pages, but only those opened after the register() is successful. i.e. a document starts life with or without a Service Worker and maintains that for its lifetime. So documents will have to be reloaded to actually be controlled.\r\n![Architecture](https://mdn.mozillademos.org/files/8241/flowchart-production-version.png)","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}